---
layout: post
title: Running Oracle BPM 12c on AWS
tagline: using Vagrant and Chef
categories: cloud
tags: [oracle, bpm, 12c, vagrant, chef, aws]
---

In this post, I will show how to create an AWS EC2 Instance with an Oracle BPM 12c Quickstart Domain created. And I will use previous post for related tasks.

Lets see how to achieve this and make this process reusable. These are the steps:
- Create an AWS EC2 instance (with Vagrant)
- Connect to an NFS instance to get the installer (with Chef)
- Install Oracle BPM 12c Quickstart and create a Domain (with Chef)

GitHub repository: [Here](https://github.com/jeqo/oracle-bpm-12c-aws)

## Create an AWS EC2 instance

I've created a Red Hat instance using Vagrant. This instance should be connected to my NFS instance that has all the Oracle's installers (to create an NFS instance on AWS EC2: [go here](http://jeqo.github.io/blog/devops/create-nfs-instance-aws/)).

This is the NFS instance:

![NFS instance](https://github.com/jeqo/blog/raw/gh-pages/images/2014-12-11-run-bpm-12c-aws/2014-12-11_0836.png "NFS Instance")

And the "/data" directory is shared. It includes Oracle XE and Oracle FMW installers:

![NFS directories](https://github.com/jeqo/blog/raw/gh-pages/images/2014-12-11-run-bpm-12c-aws/2014-12-11_0841.png "NFS directories")

### Vagrant configuration

[Gist](https://gist.github.com/jeqo/62b74a9ed65d575d91b4)

{% gist 62b74a9ed65d575d91b4 Vagrantfile %}

Running this file with:

```bash
vagrant up --provider=aws
```

You will create a new instance on AWS EC2.

## Connect to an NFS instance

The first recipe that will be executed is:

```ruby
...
  chef.add_role "nfs-client"
...
```

This call the following Chef role:

```json
{
  "name" : "nfs-client",
  "description" : "Role applied to the system that should be an NFS client tools.",
  "json_class" : "Chef::Role",
  "default_attributes" : {
    "nfs-client" : {
      "server-host" : "localhost",
      "local-directory" : "/data",
      "remote-directory" : "/data"
    }
  },
  "run_list" : [
    "recipe[nfs-utils::nfs-client]"
  ]
}

```

To update the server-host from your Vagrant configuration, add these lines:

```ruby
...
chef.json = {
  "nfs-client" => {
    "server-host" => "123.1.1.12"
  },
  ...
```

And when your instance started, a new directory "/data" will sync the NFS shared directories.

## Install Oracle BPM 12c Quickstart

To install BPM, you can download my shared ["oracle-fmw" cookbook](https://supermarket.chef.io/cookbooks/oracle-fmw) from Chef Supermarket. It is explained in [this post](http://jeqo.github.io/blog/devops/chef-cookbook-oracle-fmw-12c/).

Vagrant configuration calls this Chef role:

```json
{
  "name" : "demo-bpm_bam-12c",
  "json_class" : "Chef::Role",
  "default_attributes" : {
    "domain-12c": {
      "name": "demo-bpm_bam-domain",
      "mode": "Compact",
      "apps": [
        {"name" : "SOA", "enabled" : true},
        {"name" : "BPM", "enabled" : true},
        {"name" : "BAM", "enabled" : true},
        {"name" : "OSB", "enabled" : false}
      ],
      "machines": [
      ],
      "admin_server": {
        "base_name" : "AdminServer",
        "new_name" : "bpm_bpm-server",
        "port" : "7001"
      },
      "managed_servers": [
      ],
      "db_repo_host": "localhost",
      "db_repo_port": "1521",
      "db_repo_sid": "xe",
      "db_repo_prefix": "DEMO",
      "db_repo_password": "welcome1"
    },
    "rcu-12c": {
      "db_schema_prefix": "DEMO",
      "db_dba_user": "SYS",
      "db_dba_role": "SYSDBA",
      "db_dba_password": "welcome1",
      "db_schemas_password": "welcome1",
      "db_hostname": "localhost",
      "db_port": "1521",
      "db_service": "xe",
      "components": [
        "SOAINFRA",
        "OPSS",
        "IAU",
        "MDS",
        "WLS",
        "UCSUMS",
        "IAU_APPEND",
        "IAU_VIEWER"
      ]
    }
  },
  "run_list" : [
    "recipe[oracle-fmw::install-bpm_qs-12c]",
    "recipe[oracle-fmw::create-rcu_repository-12c]",
    "recipe[oracle-fmw::create-domain-12c]"
  ]
}
```

This includes will run three recipes: "install-bpm_qs-12c" , "create-rcu_repository-12c", "create-domain-12c". And includes Domain information ("domain-12c"), and RCU info ("rcu-12c").

These process takes 30 min. approx. And now we can login with "oracle-fmw" user (password: welcome1), and start the server:

![Start server](https://github.com/jeqo/blog/raw/gh-pages/images/2014-12-11-run-bpm-12c-aws/2014-12-11_0930.png "Stating WebLogic Server")

![Server started](https://github.com/jeqo/blog/raw/gh-pages/images/2014-12-11-run-bpm-12c-aws/2014-12-11_0931.png "WebLogic Server with BPM started")

That's it.
